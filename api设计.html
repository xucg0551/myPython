用户名+密码------>token(服务器返回的，服务器可以把token放在缓存里)，相当于获取一个访问凭证，有了token之后，就没有用户名和密码啥事了，只凭token就行了。

url: http://wwww.xxxx.com/getxxx?k1=v1&k2=v2&token=xxxxxx

但是这样子的接口安全吗？

1.第一个问题：如果token被非法窃取了，那不就可以任意访问url了吗？

2.第二个问题：怎么防止合法用户的随时及任意的访问？

3.第三个问题：如果防止被非法篡改参数？

为了解决第二个问题，请求时要加上时间戳(注意客户端和服务器端时间要保持一致)，当时间大于一定时间，则视为无效请求。
为了解决第一、三个问题，对请求参数进行排序且用MD5进行签名生成参数sign()，sign=MD5(排序的参数+客户端和服务器端约好的字符串(不能让第三方知道哦，关键中的关键))，也可以sign=加密(MD5(排序的参数))

url: http://wwww.xxxx.com/getxxx?k1=v1&k2=v2&timestamp=xxxxxx&token=xxxxxx&sign=xxxxxx

这样子，服务器端对 k1=v1&k2=v2&timestamp=xxxxxx&token=xxxxxx 进行MD5验签，如果和请求的sign不符，则视为无效请求，如果相符，再进行token和timestamp验证。。。

拓展：可以实现 拒绝重复攻击 的设计吗 ？
可以，只要服务器把客户端的sign放到缓存器里就行了，就算黑客拿到完整的url后，也只能访问一次(就不用考虑timestamp了)，并不能进行重复攻击，因为它不能构造出完整的url(因为它构造不出来sign(需要客户端和服务器端约好的字符串))

总结：接口的安全设计要围绕token、timestamp、sign作文章，同时还要考虑接口不能太过复杂性！




csrf攻击
场景：话说那是一个月黑风高的夜晚，黑客哥发现隔壁老王在屋里偷笑，得知老王正在登陆某银行界面，数账户小数点前面的位数。黑客哥顿时冒出个邪恶的想法：怎么调戏一把老王呢？突然灵光一现，马上写了个网页，上面放上苍"老师"动作片的小广告。老王一不小心看到了，小心脏一激动，
手一打颤，点进去了。可老王哪里知道，回头再去看自己的账户时，竟然少了1分钱(老王的眼睛很毒辣)，傻了眼了，心想：太狠了，我看苍"老师"的电影都不要钱啊，何况还只是点了她的小广告啊！我的那宝贵的1分救命钱去哪了？

原来黑客哥想到了使用CSRF的攻击方式，他的小广告里竟深藏了天大的秘密：里面是个网址:http://www.xxxbank.com/transfer?from=老五&to=黑客哥&money=0.01，竟然是个钓鱼网站。内容是叫银行从老王的账户转账0.01元钱到黑客哥的账户上。

那什么是csfr攻击呢？原理如下：

1. 用户C打开浏览器，访问受信任网站A，输入用户名和密码请求登录网站A；

2.在用户信息通过验证后，网站A产生Cookie信息并返回给浏览器，此时用户登录网站A成功，可以正常发送请求到网站A；

3. 用户未退出网站A之前，在同一浏览器中，打开一个TAB页访问网站B；

4. 网站B接收到用户请求后，返回一些攻击性代码，并发出一个请求要求访问第三方站点A；

5. 浏览器在接收到这些攻击性代码后，根据网站B的请求，在用户不知情的情况下携带Cookie信息，向网站A发出请求。网站A并不知道该请求其实是由B发起的，所以会根据用户C的Cookie信息以C的权限处理该请求，导致来自网站B的恶意代码被执行。

要实现csrf的攻击，前提条件之一，就是用户的session没有失效！

怎么防御？

CSRF攻击之所以能够成功，是因为黑客可以完全伪造用户的请求，该请求中所有的用户验证信息都是存在于cookie中，因此黑客可以在不知道这些验证信息的情况下直接利用用户自己的cookie来通过安全验证。
要抵御CSRF，关键在于在请求中放入黑客所不能伪造的信息，并且该信息不存在于cookie之中。可以在HTTP请求中以参数的形式加入一个随机产生的token，并在服务器端建立一个拦截器来验证这个token，
如果请求中没有token或者token内容不正确则认为可能是CSRF攻击而拒绝该请求。

总的一句话：生成随机串token，且不放在cookie中，且作为请求头发送给服务端进行验证即可。














